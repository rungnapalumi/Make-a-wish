import streamlit as st
import smtplib
import os
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.base import MIMEBase
from email import encoders
import tempfile

st.set_page_config(page_title="Video Submission", layout="wide")

st.title("üé¨ AI People Reader - Video Submission System")

# Demo Video Section
st.header("üìπ Demo Video")
st.markdown("**Video Interview Simulation** - Sample video for demonstration")

demo_video_path = "Video Interview Simulation.mp4"
if os.path.exists(demo_video_path):
    st.video(demo_video_path)
    
    # Add Thai instructions under the video
    st.markdown("---")
    st.markdown("""
    ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏Å‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß 
    ‡∏Ç‡∏≠‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡∏®‡∏£‡∏µ‡∏©‡∏∞ ‡∏°‡∏∑‡∏≠ ‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤ ‡∏ö‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á‡∏ñ‡∏∂‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏û‡∏π‡∏î
    
    **AI People Reader App** ‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏ß‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ 4 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ
    
    1. ‡∏ú‡∏π‡πâ‡∏û‡∏π‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ engage ‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    2. ‡∏ú‡∏π‡πâ‡∏û‡∏π‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    3. ‡∏ú‡∏π‡πâ‡∏û‡∏π‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á ‡∏¢‡∏∑‡∏ô‡∏Å‡∏£‡∏≤‡∏ô‡πÉ‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    4. ‡∏ú‡∏π‡πâ‡∏û‡∏π‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ü‡∏±‡∏á‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    
    ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏°‡∏µ guideline ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡πà‡∏≤‡∏¢‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° upload ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß 
    ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡∏Ñ‡∏•‡∏¥‡∏õ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ username ‡πÅ‡∏•‡∏∞ password log in ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≤‡∏á laptop ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏Ñ‡∏•‡∏¥‡∏õ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á 
    ‡πÇ‡∏î‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏Ñ‡∏•‡∏¥‡∏õ ‡πÅ‡∏•‡∏∞ resolution ‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ **Upload Your Video** ‡πÅ‡∏•‡πâ‡∏ß
    
    **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
    """)
    st.markdown("---")
else:
    st.warning(f"‚ö†Ô∏è Demo video '{demo_video_path}' not found in the current directory.")

st.header("üìß Send Your Video via Email")

st.info("üí° **Instructions**: Upload your video and it will be sent directly to the analysis team via email.")

st.warning("‚ö†Ô∏è **Note**: This is a demo version. Videos are prepared for email but not actually sent. In production, SMTP settings would be configured.")

# Email form
with st.form("email_form"):
    st.subheader("üìù Video Submission Form")
    
    # Recipient selection
    recipient = st.selectbox(
        "Send video to:",
        ["alisa@imagematters.at", "rungnapa@imagematters.at"],
        help="Select who should receive your video for analysis"
    )
    
    # Sender info
    sender_name = st.text_input("Your Name:", placeholder="Enter your name")
    sender_email = st.text_input("Your Email:", placeholder="your.email@example.com")
    
    # Message
    message = st.text_area(
        "Message (optional):", 
        placeholder="Any additional notes about your video...",
        height=100
    )
    
    # File upload
    uploaded_file = st.file_uploader(
        "Choose a video file", 
        type=["mp4", "mov", "avi", "mpeg4"],
        help="Upload your interview video"
    )
    
    submit_button = st.form_submit_button("üì§ Send Video", type="primary")

if submit_button:
    if not uploaded_file:
        st.error("‚ùå Please select a video file to send.")
    elif not sender_name or not sender_email:
        st.error("‚ùå Please fill in your name and email address.")
    else:
        try:
            # Show file info
            file_size = len(uploaded_file.getvalue())
            file_size_mb = file_size / (1024 * 1024)
            
            st.info(f"üìÅ File: {uploaded_file.name} ({file_size_mb:.1f} MB)")
            
            with st.spinner("üì§ Sending email..."):
                # Create email message
                msg = MIMEMultipart()
                msg['From'] = sender_email
                msg['To'] = recipient
                msg['Subject'] = f"Video Submission from {sender_name} - {uploaded_file.name}"
                
                # Email body
                body = f"""
Hello,

You have received a new video submission from {sender_name}.

Video Details:
- File: {uploaded_file.name}
- Size: {file_size_mb:.1f} MB
- Sender: {sender_name} ({sender_email})

Message:
{message if message else "No additional message provided."}

Please process this video for analysis.

Best regards,
AI People Reader System
                """
                
                msg.attach(MIMEText(body, 'plain'))
                
                # Attach video file
                attachment = MIMEBase('application', 'octet-stream')
                attachment.set_payload(uploaded_file.getvalue())
                encoders.encode_base64(attachment)
                attachment.add_header(
                    'Content-Disposition',
                    f'attachment; filename= {uploaded_file.name}'
                )
                msg.attach(attachment)
                
                # For demo purposes, we'll simulate sending
                # In production, you'd use actual SMTP settings
                st.success(f"‚úÖ Video sent successfully to {recipient}!")
                st.info("üìß Email sent with your video attached. The analysis team will process it shortly.")
                
                # Show what was sent
                st.subheader("üìã Submission Summary")
                col1, col2 = st.columns(2)
                with col1:
                    st.write(f"**Recipient:** {recipient}")
                    st.write(f"**Sender:** {sender_name}")
                    st.write(f"**File:** {uploaded_file.name}")
                with col2:
                    st.write(f"**Size:** {file_size_mb:.1f} MB")
                    st.write(f"**Status:** ‚úÖ Sent")
                
        except Exception as e:
            st.error(f"‚ùå Failed to send email: {str(e)}")
            st.info("üí° Please check your internet connection and try again.")